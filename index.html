<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 æ”¿å¤§EMBAå–®è»Šç¤¾è³“æœæŒ‘æˆ°</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif; background: #fdf5e6; text-align: center; margin: 0; padding: 20px; }
        h1 { color: #b71c1c; margin-bottom: 5px; font-size: 1.5em; }
        .sub-title { color: #555; font-size: 0.9em; margin-bottom: 20px; }
        
        /* è³“æœç›¤é¢ */
        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            max-width: 500px;
            margin: 0 auto;
        }

        .cell {
            aspect-ratio: 1/1;
            background: white;
            border: 2px solid #b71c1c;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            padding: 2px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .cell.active {
            background: #b71c1c;
            color: white;
            box-shadow: 0 0 10px rgba(183, 28, 28, 0.5);
        }

        .icon { font-size: 16px; margin-bottom: 2px; }
        .name { font-weight: bold; line-height: 1.2; }
        
        /* ç‹€æ…‹åˆ— */
        #status { margin-top: 20px; padding: 10px; background: #fff; border-radius: 50px; display: inline-block; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn { background: #333; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-top: 20px; cursor: pointer; }
        
        /* ç²å‹ç‰¹æ•ˆ */
        #winner-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); color: gold; flex-direction: column;
            align-items: center; justify-content: center; z-index: 999;
        }
        #winner-overlay h2 { font-size: 3em; margin: 0; text-shadow: 0 0 20px red; }
    </style>
</head>
<body>

    <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" width="40" style="margin-bottom:10px;">
    <h1>2026 æ”¿å¤§EMBAå–®è»Šç¤¾è³“æœæŒ‘æˆ°</h1>
    <p class="sub-title">ç›®æ¨™ï¼šé€£æˆäº”æ¢ç·šå³å®ŒæˆæŒ‘æˆ°ï¼</p>

    <div class="grid" id="bingo-grid">
        </div>

    <div id="status">ğŸ“ GPS å®šä½ä¸­...</div>
    
    <br>
    <button class="btn" onclick="checkLocation()">ğŸ”„ æˆ‘åˆ°äº†ï¼æ‰‹å‹•æ‰“å¡</button>
    <p style="color:#999; font-size:10px; margin-top:30px;">æ¸¬è©¦æ¨¡å¼ï¼šé»æ“Šæ ¼å­ 5 æ¬¡å¯å¼·åˆ¶æ‰‹å‹•äº®ç‡ˆ</p>

    <div id="winner-overlay">
        <h2>BINGO!</h2>
        <p>æ­å–œå®ŒæˆæŒ‘æˆ°ï¼</p>
        <button class="btn" onclick="closeWinner()">å¤ªç¥å•¦</button>
    </div>

<script>
    // é€™è£¡å¡«å…¥ç¬¬ä¸€æ’çš„çœŸå¯¦åº§æ¨™ (å…¶ä»–çš„æˆ‘å…ˆç”¨ 0,0 ä»£æ›¿ï¼Œä¹‹å¾Œè£œä¸Š)
    const locations = [
        { id: 1, name: "å°å—\næ——å“¥ç‰›è‚‰æ¹¯", lat: 23.009935, lng: 120.185494, icon: "ğŸ²" },
        { id: 2, name: "å¾©èˆˆ\nç¾è…¿å±±å’–å•¡", lat: 24.800184, lng: 121.312536, icon: "â˜•" },
        { id: 3, name: "å®œè˜­\næ˜æ± å±±èŠ", lat: 24.650600, lng: 121.473000, icon: "ğŸŒ²" },
        { id: 4, name: "ç¦å±±\né¦¬å²¸é¤å»³", lat: 24.774638, lng: 121.500699, icon: "ğŸ²" },
        { id: 5, name: "å˜‰ç¾©\né˜¿å©†ç£", lat: 23.361760, lng: 120.580500, icon: "ğŸª" },
        // ... (ç¬¬6-25æ ¼å…ˆç”¨å‡è³‡æ–™ï¼Œé¿å…ç‰ˆé¢å£æ‰)
        ...Array.from({length: 20}, (_, i) => ({ id: i+6, name: `ç¬¬${i+6}æ ¼\nå¾…è£œåº§æ¨™`, lat: 0, lng: 0, icon: "ğŸš©" }))
    ];

    // è®€å–ç´€éŒ„
    let savedState = JSON.parse(localStorage.getItem('bingoState')) || [];

    const grid = document.getElementById('bingo-grid');
    const statusDiv = document.getElementById('status');
    let clickCounts = {}; // ç”¨æ–¼æ¸¬è©¦æ¨¡å¼çš„è¨ˆæ•¸å™¨

    // åˆå§‹åŒ–ç•«é¢
    function init() {
        grid.innerHTML = "";
        locations.forEach(loc => {
            let cell = document.createElement('div');
            cell.className = 'cell ' + (savedState.includes(loc.id) ? 'active' : '');
            cell.innerHTML = `<div class="icon">${loc.icon}</div><div class="name">${loc.name.replace('\n','<br>')}</div>`;
            
            // æ¸¬è©¦æ¨¡å¼ï¼šé€£çºŒé»æ“Š 5 æ¬¡å¯ä»¥å¼·åˆ¶äº®ç‡ˆ
            cell.onclick = () => {
                clickCounts[loc.id] = (clickCounts[loc.id] || 0) + 1;
                if(clickCounts[loc.id] >= 5) {
                    markVisited(loc.id);
                    clickCounts[loc.id] = 0;
                }
            };
            
            grid.appendChild(cell);
        });
        checkBingo(); // æª¢æŸ¥æ˜¯å¦é€£ç·š
    }

    // æ¨™è¨˜å®Œæˆ
    function markVisited(id) {
        if (!savedState.includes(id)) {
            savedState.push(id);
            localStorage.setItem('bingoState', JSON.stringify(savedState));
            init(); // é‡ç¹ª
            alert(`æ‰“å¡æˆåŠŸï¼åœ°é» ID: ${id}`);
        }
    }

    // æª¢æŸ¥ GPS
    function checkLocation() {
        statusDiv.innerText = "ğŸ›°ï¸ æ­£åœ¨æœå°‹è¡›æ˜Ÿ...";
        if (!navigator.geolocation) {
            alert("ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´ GPS");
            return;
        }
        navigator.geolocation.getCurrentPosition(position => {
            const userLat = position.coords.latitude;
            const userLng = position.coords.longitude;
            let found = false;

            statusDiv.innerText = `ğŸ“ ç›®å‰ä½ç½®ï¼š${userLat.toFixed(4)}, ${userLng.toFixed(4)}`;

            locations.forEach(loc => {
                // å¦‚æœå·²ç¶“æ‰“éå¡å°±ä¸ç®—äº†
                if(savedState.includes(loc.id)) return;

                // è¨ˆç®—è·é›¢ (å–®ä½ï¼šå…¬é‡Œ)
                const dist = getDistanceFromLatLonInKm(userLat, userLng, loc.lat, loc.lng);
                
                // åˆ¤å®šç¯„åœï¼š500å…¬å°º (0.5km)
                if (dist < 0.5) { 
                    markVisited(loc.id);
                    found = true;
                }
            });

            if(!found) {
                // alert("é™„è¿‘æ²’æœ‰è³“æœé»å–”ï¼å†é è¿‘ä¸€é»è©¦è©¦çœ‹ã€‚");
            }
        }, error => {
            statusDiv.innerText = "âŒ ç„¡æ³•å–å¾—ä½ç½®";
            alert("è«‹å…è¨±ç¶²é å­˜å– GPS ä½ç½®");
        });
    }

    // è¨ˆç®—åœ°çƒå…©é»è·é›¢å…¬å¼ (Haversine formula)
    function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
        var R = 6371; 
        var dLat = deg2rad(lat2-lat1); 
        var dLon = deg2rad(lon2-lon1); 
        var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
        return R * c;
    }
    function deg2rad(deg) { return deg * (Math.PI/180); }

    // è³“æœé€£ç·šåˆ¤å®šé‚è¼¯
    function checkBingo() {
        const lines = [
            [1,2,3,4,5], [6,7,8,9,10], [11,12,13,14,15], [16,17,18,19,20], [21,22,23,24,25], // æ©«ç·š
            [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24], [5,10,15,20,25], // ç›´ç·š
            [1,7,13,19,25], [5,9,13,17,21] // å°è§’ç·š
        ];
        
        let winCount = 0;
        lines.forEach(line => {
            if (line.every(id => savedState.includes(id))) winCount++;
        });

        if (winCount >= 5) {
            document.getElementById('winner-overlay').style.display = 'flex';
        }
    }

    function closeWinner() {
        document.getElementById('winner-overlay').style.display = 'none';
    }

    // å•Ÿå‹• LINE LIFF (é¸ç”¨)
    async function main() {
        await liff.init({ liffId: "2008939051-CMBzqbtq" }).catch(err => console.log(err));
        if(liff.isLoggedIn()){
             // å¯ä»¥åœ¨é€™è£¡å–å¾—ä½¿ç”¨è€…åå­—
        }
        init();
    }
    main();

</script>
</body>
</html>
